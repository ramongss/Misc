Sys.setenv("LANGUAGE" = "En")
Sys.setlocale("LC_ALL", "English")
library(tidyverse)
library(extrafont)
url_confirmed <- 'https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_confirmed_global.csv'
url_death <- 'https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_deaths_global.csv'
data_br <- read.csv(file = url_confirmed)  %>%
filter(Country.Region == "Brazil") %>%
subset(select = -c(Province.State, Country.Region, Lat, Long)) %>%
t() %>%
data.frame(
'date' = seq.Date(from = as.Date('2020-01-22'), by = 'day', length.out = nrow(.)),
'confirmed' = .
)
data_br$deaths <- read.csv(file = url_death)  %>%
filter(Country.Region == "Brazil") %>%
subset(select = -c(Province.State, Country.Region, Lat, Long)) %>%
t()
colnames(data_br) <- c('date','confirmed','deaths')
data_br$inc_confirmed <- NA
data_br$inc_deaths <- NA
for (row in seq(nrow(data_br))) {
if (row == 1) {
data_br[row, "inc_confirmed"] <- data_br[row, 'confirmed']
data_br[row, "inc_deaths"] <- data_br[row, 'deaths']
} else{
data_br[row, "inc_confirmed"] <- data_br[row, "confirmed"] - data_br[row-1, "confirmed"]
data_br[row, "inc_deaths"] <- data_br[row, "deaths"] - data_br[row-1, "deaths"]
}
}
data_br$mmconfirmed <- NA
data_br$mmdeaths <- NA
for (row in seq(nrow(data_br))) {
if (row < 7) {
data_br[row, 'mmconfirmed'] <- 0
data_br[row, 'mmdeaths'] <- 0
} else{
data_br[row, 'mmconfirmed'] <- mean(
c(
data_br[row, 'inc_confirmed'],
data_br[row - 1, 'inc_confirmed'],
data_br[row - 2, 'inc_confirmed'],
data_br[row - 3, 'inc_confirmed'],
data_br[row - 4, 'inc_confirmed'],
data_br[row - 5, 'inc_confirmed'],
data_br[row - 6, 'inc_confirmed']
)
)
data_br[row, 'mmdeaths'] <- mean(
c(
data_br[row, 'inc_deaths'],
data_br[row - 1, 'inc_deaths'],
data_br[row - 2, 'inc_deaths'],
data_br[row - 3, 'inc_deaths'],
data_br[row - 4, 'inc_deaths'],
data_br[row - 5, 'inc_deaths'],
data_br[row - 6, 'inc_deaths']
)
)
}
}
legend_deaths <- "Moving average of the daily deaths in the last seven days in Brazil"
mm_deaths <- data_br %>%
ggplot() +
geom_col(aes(x = date, y = inc_deaths), size = 1, fill = "#9B0000", alpha = .3) +
geom_line(aes(x = date, y = mmdeaths), group = 1, size = 3.5, color = "white") +
geom_line(aes(x = date, y = mmdeaths, lty = legend_deaths), group = 1, size = 1.2, color = "#9B0000") +
scale_x_date(
date_breaks = '1 month',
date_labels = '%b %Y',
limits = c(as.Date(min(data_br$date)), as.Date(max(data_br$date))),
) +
theme(
text = element_text(size = 25, family = 'CM Roman'),
axis.title = element_blank(),
axis.ticks.y = element_blank(),
panel.background = element_rect(fill = "white"),
axis.line.x.bottom = element_line(size = 1),
panel.grid.major.y = element_line(size = 0.5, color = 'gray95'),
panel.grid.minor.y = element_line(size = 0.5, color = 'gray95'),
panel.grid.major.x = element_blank(),
axis.text.y = element_text(vjust = -0.3, color = "gray50"),
axis.text.x = element_text(angle = 45, hjust = 1),
axis.ticks.x = element_line(size = 1),
axis.ticks.length = unit(.25, "cm"),
legend.text = element_text(size = 18, color = "gray50"),
legend.key = element_blank(),
legend.title = element_blank(),
legend.position = 'top',
legend.justification = 'left',
plot.caption = element_text(size = 12, color = "gray50"),
) +
scale_y_continuous(expand = c(0,0), breaks = seq(0,2000,500)) +
geom_text(aes(x = as.Date(min(data_br$date)), y = 2200, label="Stretch it"), vjust=-1) +
annotate(geom = 'text', x = as.Date(min(data_br$date)), y = 2000, hjust = .35, vjust = -.30,
label = 'daily deaths', color = 'gray50', family = 'CM Roman', size = 7) +
labs(
caption = paste0(
'Source: Johns Hopkins University CSSE COVID-19 Data - Last Updated\n',
format(Sys.time(), '%d %b %Y, %H:%M'),
'(Brazil Time) | @ramongss'
)
)
mm_deaths %>%
ggsave(
filename = here::here('Misc','MM_covid','mm_deaths.pdf'),
device = 'pdf',
dpi = 1200,
units = 'in',
width = 12,
height = 6.75
)
mm_deaths %>%
ggsave(
filename = here::here('Misc','MM_covid','mm_deaths.png'),
device = 'png',
dpi = 1200,
units = 'in',
width = 12,
height = 6.75
)
legend_confirmed <- "Moving average of the daily confirmed cases in the last seven days in Brazil"
mm_confirmed <- data_br %>%
ggplot() +
geom_col(aes(x = date, y = inc_confirmed), size = 1, fill = "#2171B5", alpha = .3) +
geom_line(aes(x = date, y = mmconfirmed), group = 1, size = 3.5, color = "white") +
geom_line(aes(x = date, y = mmconfirmed, lty = legend_confirmed), group = 1, size = 1.2, color = "#2171B5") +
scale_x_date(
date_breaks = '1 month',
date_labels = '%b %Y',
limits = c(as.Date(min(data_br$date)), as.Date(max(data_br$date))),
) +
theme(
text = element_text(size = 25, family = 'CM Roman'),
axis.title = element_blank(),
axis.ticks.y = element_blank(),
panel.background = element_rect(fill = "white"),
axis.line.x.bottom = element_line(size = 1),
panel.grid.major.y = element_line(size = 0.5, color = 'gray95'),
panel.grid.minor.y = element_line(size = 0.5, color = 'gray95'),
panel.grid.major.x = element_blank(),
axis.text.y = element_text(vjust = -0.3, color = "gray50"),
axis.text.x = element_text(angle = 45, hjust = 1),
axis.ticks.x = element_line(size = 1),
axis.ticks.length = unit(.25, "cm"),
legend.text = element_text(size = 18, color = "gray50"),
legend.key = element_blank(),
legend.title = element_blank(),
legend.position = 'top',
legend.justification = 'left',
plot.caption = element_text(size = 12, color = "gray50"),
) +
scale_y_continuous(expand = c(0,0), breaks = seq(0,90000,30000)) +
geom_text(aes(x = as.Date(min(data_br$date)), y = 95000, label="Stretch it"), vjust=-1) +
annotate(geom = 'text', x = as.Date(min(data_br$date)), y = 90000, hjust = .15, vjust = -.30,
label = 'daily confirmed cases', color = 'gray50', family = 'CM Roman', size = 7) +
labs(
caption = paste0(
'Source: Johns Hopkins University CSSE COVID-19 Data - Last Updated\n',
format(Sys.time(), '%d %b %Y, %H:%M'),
'(Brazil Time) | @ramongss'
)
)
mm_confirmed %>%
ggsave(
filename = here::here('Misc','MM_covid','mm_confirmed.pdf'),
device = 'pdf',
dpi = 1200,
units = 'in',
width = 12,
height = 6.75
)
mm_confirmed %>%
ggsave(
filename = here::here('Misc','MM_covid','mm_confirmed.png'),
device = 'png',
dpi = 1200,
units = 'in',
width = 12,
height = 6.75
)
Sys.setenv("LANGUAGE" = "En")
Sys.setlocale("LC_ALL", "English")
library(tidyverse)
library(extrafont)
url_confirmed <- 'https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_confirmed_global.csv'
url_death <- 'https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_deaths_global.csv'
data_br <- read.csv(file = url_confirmed)  %>%
filter(Country.Region == "Brazil") %>%
subset(select = -c(Province.State, Country.Region, Lat, Long)) %>%
t() %>%
data.frame(
'date' = seq.Date(from = as.Date('2020-01-22'), by = 'day', length.out = nrow(.)),
'confirmed' = .
)
data_br$deaths <- read.csv(file = url_death)  %>%
filter(Country.Region == "Brazil") %>%
subset(select = -c(Province.State, Country.Region, Lat, Long)) %>%
t()
colnames(data_br) <- c('date','confirmed','deaths')
data_br$inc_confirmed <- NA
data_br$inc_deaths <- NA
for (row in seq(nrow(data_br))) {
if (row == 1) {
data_br[row, "inc_confirmed"] <- data_br[row, 'confirmed']
data_br[row, "inc_deaths"] <- data_br[row, 'deaths']
} else{
data_br[row, "inc_confirmed"] <- data_br[row, "confirmed"] - data_br[row-1, "confirmed"]
data_br[row, "inc_deaths"] <- data_br[row, "deaths"] - data_br[row-1, "deaths"]
}
}
data_br$mmconfirmed <- NA
data_br$mmdeaths <- NA
for (row in seq(nrow(data_br))) {
if (row < 7) {
data_br[row, 'mmconfirmed'] <- 0
data_br[row, 'mmdeaths'] <- 0
} else{
data_br[row, 'mmconfirmed'] <- mean(
c(
data_br[row, 'inc_confirmed'],
data_br[row - 1, 'inc_confirmed'],
data_br[row - 2, 'inc_confirmed'],
data_br[row - 3, 'inc_confirmed'],
data_br[row - 4, 'inc_confirmed'],
data_br[row - 5, 'inc_confirmed'],
data_br[row - 6, 'inc_confirmed']
)
)
data_br[row, 'mmdeaths'] <- mean(
c(
data_br[row, 'inc_deaths'],
data_br[row - 1, 'inc_deaths'],
data_br[row - 2, 'inc_deaths'],
data_br[row - 3, 'inc_deaths'],
data_br[row - 4, 'inc_deaths'],
data_br[row - 5, 'inc_deaths'],
data_br[row - 6, 'inc_deaths']
)
)
}
}
legend_deaths <- "Moving average of the daily deaths in the last seven days in Brazil"
mm_deaths <- data_br %>%
ggplot() +
geom_col(aes(x = date, y = inc_deaths), size = 1, fill = "#9B0000", alpha = .3) +
geom_line(aes(x = date, y = mmdeaths), group = 1, size = 3.5, color = "white") +
geom_line(aes(x = date, y = mmdeaths, lty = legend_deaths), group = 1, size = 1.2, color = "#9B0000") +
scale_x_date(
date_breaks = '1 month',
date_labels = '%b %Y',
limits = c(as.Date(min(data_br$date)), as.Date(max(data_br$date))),
) +
theme(
text = element_text(size = 25, family = 'CM Roman'),
axis.title = element_blank(),
axis.ticks.y = element_blank(),
panel.background = element_rect(fill = "white"),
axis.line.x.bottom = element_line(size = 1),
panel.grid.major.y = element_line(size = 0.5, color = 'gray95'),
panel.grid.minor.y = element_line(size = 0.5, color = 'gray95'),
panel.grid.major.x = element_blank(),
axis.text.y = element_text(vjust = -0.3, color = "gray50"),
axis.text.x = element_text(angle = 45, hjust = 1),
axis.ticks.x = element_line(size = 1),
axis.ticks.length = unit(.25, "cm"),
legend.text = element_text(size = 18, color = "gray50"),
legend.key = element_blank(),
legend.title = element_blank(),
legend.position = 'top',
legend.justification = 'left',
plot.caption = element_text(size = 12, color = "gray50"),
) +
scale_y_continuous(expand = c(0,0), breaks = seq(0,2000,500)) +
geom_text(aes(x = as.Date(min(data_br$date)), y = 2200, label="Stretch it"), vjust=-1) +
annotate(geom = 'text', x = as.Date(min(data_br$date)), y = 2000, hjust = .35, vjust = -.30,
label = 'daily deaths', color = 'gray50', family = 'CM Roman', size = 7) +
labs(
caption = paste0(
'Source: Johns Hopkins University CSSE COVID-19 Data - Last Updated\n',
format(Sys.time(), '%d %b %Y, %H:%M'),
'(Brazil Time) | @ramongss'
)
)
mm_deaths %>%
ggsave(
filename = here::here('MM_covid','mm_deaths.pdf'),
device = 'pdf',
dpi = 1200,
units = 'in',
width = 12,
height = 6.75
)
mm_deaths %>%
ggsave(
filename = here::here('MM_covid','mm_deaths.png'),
device = 'png',
dpi = 1200,
units = 'in',
width = 12,
height = 6.75
)
legend_confirmed <- "Moving average of the daily confirmed cases in the last seven days in Brazil"
mm_confirmed <- data_br %>%
ggplot() +
geom_col(aes(x = date, y = inc_confirmed), size = 1, fill = "#2171B5", alpha = .3) +
geom_line(aes(x = date, y = mmconfirmed), group = 1, size = 3.5, color = "white") +
geom_line(aes(x = date, y = mmconfirmed, lty = legend_confirmed), group = 1, size = 1.2, color = "#2171B5") +
scale_x_date(
date_breaks = '1 month',
date_labels = '%b %Y',
limits = c(as.Date(min(data_br$date)), as.Date(max(data_br$date))),
) +
theme(
text = element_text(size = 25, family = 'CM Roman'),
axis.title = element_blank(),
axis.ticks.y = element_blank(),
panel.background = element_rect(fill = "white"),
axis.line.x.bottom = element_line(size = 1),
panel.grid.major.y = element_line(size = 0.5, color = 'gray95'),
panel.grid.minor.y = element_line(size = 0.5, color = 'gray95'),
panel.grid.major.x = element_blank(),
axis.text.y = element_text(vjust = -0.3, color = "gray50"),
axis.text.x = element_text(angle = 45, hjust = 1),
axis.ticks.x = element_line(size = 1),
axis.ticks.length = unit(.25, "cm"),
legend.text = element_text(size = 18, color = "gray50"),
legend.key = element_blank(),
legend.title = element_blank(),
legend.position = 'top',
legend.justification = 'left',
plot.caption = element_text(size = 12, color = "gray50"),
) +
scale_y_continuous(expand = c(0,0), breaks = seq(0,90000,30000)) +
geom_text(aes(x = as.Date(min(data_br$date)), y = 95000, label="Stretch it"), vjust=-1) +
annotate(geom = 'text', x = as.Date(min(data_br$date)), y = 90000, hjust = .15, vjust = -.30,
label = 'daily confirmed cases', color = 'gray50', family = 'CM Roman', size = 7) +
labs(
caption = paste0(
'Source: Johns Hopkins University CSSE COVID-19 Data - Last Updated\n',
format(Sys.time(), '%d %b %Y, %H:%M'),
'(Brazil Time) | @ramongss'
)
)
mm_confirmed %>%
ggsave(
filename = here::here('MM_covid','mm_confirmed.pdf'),
device = 'pdf',
dpi = 1200,
units = 'in',
width = 12,
height = 6.75
)
mm_confirmed %>%
ggsave(
filename = here::here('MM_covid','mm_confirmed.png'),
device = 'png',
dpi = 1200,
units = 'in',
width = 12,
height = 6.75
)
